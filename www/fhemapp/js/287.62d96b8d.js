"use strict";(self["webpackChunkfhemapp"]=self["webpackChunkfhemapp"]||[]).push([[287],{2584:function(t,e,s){s.r(e),s.d(e,{default:function(){return w}});var i=s(4562),a=s(4145),o=s(4886),n=s(266),r=s(1030),l=s(9223),c=s(4324),h=s(4568),p=s(9592),m=s(1713),d=s(3687),f=s(7823),u=s(7808),g=function(){var t=this,e=t._self._c;return t.item.Options.show?e(n.Z,{class:t.item.Options.setup.size||t.setup.size},[e(a.Z,{attrs:{dark:this.$vuetify.theme.dark,color:"secondary"}},[e(p.Z,{attrs:{height:"7",value:t.item.Options.status.level||t.status.level,color:t.item.Options.status.color||t.status.color,"background-color":"secondary darken-1"}}),e(o.EB,{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.name)+" "),e(d.Z),t.item.Options.status.isActive?e(i.Z,{attrs:{small:"",icon:""},on:{click:t.expand}},[e(c.Z,{attrs:{small:""}},[t._v(" "+t._s(t.maxIcon)+" ")])],1):t._e(),t.app.options.debugMode?e("jsonList",{attrs:{item:t.item}}):t._e()],1),e(l.Z),t.item.Options.status.isActive?t._e():e("div",[e(o.ZB,[e(m.Z,{attrs:{align:"center"}},[e(n.Z,{attrs:{align:"center"}},[e("div",{staticClass:"headline font-weight-bold"},[t._v(" "+t._s(t.item.Options.status.error)+" ")])])],1)],1),e(l.Z)],1),t.item.Options.status.isActive?e("div",[e(o.ZB,{staticClass:"pa-0"},[t.setup.expanded?e(m.Z,{staticClass:"ma-3",attrs:{align:"center"}},[e(n.Z,[e(h.Z,{attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"290px","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:i}){return[e(u.Z,t._g(t._b({attrs:{readonly:"",label:t.$t("app.dates.from"),"prepend-icon":"mdi-calendar"},model:{value:t.fromLocale,callback:function(e){t.fromLocale=e},expression:"fromLocale"}},"v-text-field",i,!1),s))]}}],null,!1,3273855689),model:{value:t.fromPicker,callback:function(e){t.fromPicker=e},expression:"fromPicker"}},[e(r.Z,{attrs:{locale:t.app.options.lang,"no-title":""},on:{input:t.loadChartData},model:{value:t.from,callback:function(e){t.from=e},expression:"from"}})],1)],1),e(n.Z,[e(h.Z,{attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"",left:"","max-width":"290px","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:i}){return[e(u.Z,t._g(t._b({attrs:{readonly:"",label:t.$t("app.dates.to"),"prepend-icon":"mdi-calendar"},model:{value:t.toLocale,callback:function(e){t.toLocale=e},expression:"toLocale"}},"v-text-field",i,!1),s))]}}],null,!1,3210355337),model:{value:t.toPicker,callback:function(e){t.toPicker=e},expression:"toPicker"}},[e(r.Z,{attrs:{locale:t.app.options.lang,"no-title":""},on:{input:t.loadChartData},model:{value:t.to,callback:function(e){t.to=e},expression:"to"}})],1)],1),e(n.Z,{attrs:{align:"right"}},[e(i.Z,{attrs:{icon:""},on:{click:function(e){return t.changeDate("prev")}}},[e(c.Z,[t._v("mdi-skip-backward")])],1),e(i.Z,{attrs:{icon:""},on:{click:function(e){return t.changeDate("rest")}}},[e(c.Z,[t._v("mdi-restore")])],1),e(i.Z,{attrs:{icon:""},on:{click:function(e){return t.changeDate("next")}}},[e(c.Z,[t._v("mdi-skip-forward")])],1)],1)],1):t._e(),e("apex-chart",{attrs:{options:t.chart.options,series:t.chart.series},on:{zoomed:t.afterZoom}})],1)],1):t._e(),e(l.Z),e(f.Z,{attrs:{color:"secondary darken-1"}},[e(c.Z,{staticClass:"ml-0",attrs:{color:t.item.Options.info.left1IconColor}},[t._v(" "+t._s(t.item.Options.info.left1Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.left1Text)+" ")]),e(c.Z,{staticClass:"ml-2",attrs:{color:t.item.Options.info.left2IconColor}},[t._v(" "+t._s(t.item.Options.info.left2Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.left2Text)+" ")]),e(d.Z),e(c.Z,{attrs:{color:t.item.Options.info.mid1IconColor}},[t._v(" "+t._s(t.item.Options.info.mid1Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.mid1Text)+" ")]),e(c.Z,{staticClass:"ml-2",attrs:{color:t.item.Options.info.mid2IconColor}},[t._v(" "+t._s(t.item.Options.info.mid2Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.mid2Text)+" ")]),e(d.Z),e(c.Z,{attrs:{color:t.item.Options.info.right1IconColor}},[t._v(" "+t._s(t.item.Options.info.right1Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.right1Text)+" ")]),e(c.Z,{staticClass:"ml-2 mr-0",attrs:{color:t.item.Options.info.right2IconColor}},[t._v(" "+t._s(t.item.Options.info.right2Icon)+" ")]),e("div",{staticClass:"text-truncate"},[t._v(" "+t._s(t.item.Options.info.right2Text)+" ")])],1)],1)],1):t._e()},x=[],v=s(2559),_={components:{jsonList:v.Z},props:{item:{type:Object,default:()=>({name:"chart2"})}},data:()=>({name:"chart2",maxIcon:"mdi-arrow-expand",app:{options:{debugMode:!1,lang:"de"}},status:{color:"success",level:0},setup:{expanded:!1,size:"col-12 col-sm-12 col-md-6 col-lg-4"},from:"",to:"",fromLocale:"",toLocale:"",fromPicker:!1,toPicker:!1,timeSteps:null,chart:{series:[],options:{theme:{mode:"dark"},chart:{height:"auto",type:"line",toolbar:{show:!1}},tooltip:{x:{format:"ddd dd.MM.yy HH:mm:ss"}},xaxis:{type:"datetime",labels:{datetimeUTC:!1}}}}}),watch:{item:{immediate:!0,deep:!0,handler(){}},from(t){this.fromLocale=new Date(t).toLocaleString(this.app.options.lang,{dateStyle:"short"})},to(t){this.toLocale=new Date(t).toLocaleString(this.app.options.lang,{dateStyle:"short"})}},created(){this.app.options=this.$fhem.app.options,Object.assign(this.setup,this.item.Options.setup),this.chart.options.theme.mode=this.$vuetify.theme.dark?"dark":"light",this.item.Options.chartOptions&&Object.assign(this.chart.options,this.item.Options.chartOptions),this.setup.expanded&&(this.setup.expanded=!1,this.expand()),this.daysAgo=this.$fhem.getEl(this.item,"Options","setup","daysAgo"),this.daysTo=this.$fhem.getEl(this.item,"Options","setup","daysTo"),"number"!=typeof this.daysAgo&&(this.daysAgo=6),"number"!=typeof this.daysTo&&(this.daysTo=0),this.from=this.$fhem.getDate(this.daysAgo),this.to=this.$fhem.getDate(this.daysTo),this.loadChartData()},methods:{expand(){this.setup.expanded?(this.setup.size="col-12 col-sm-12 col-md-6 col-lg-4",this.setup.expanded=!1,this.maxIcon="mdi-arrow-expand",this.chart.options.chart.height="auto"):(this.setup.size="col-12",this.setup.expanded=!0,this.maxIcon="mdi-arrow-collapse",this.chart.options.chart.height=window.innerHeight>600?parseInt(window.innerHeight-320):"auto"),this.chart.options=Object.assign({},this.chart.options)},changeDate(t){if("rest"==t)this.from=this.$fhem.getDate(this.daysAgo),this.to=this.$fhem.getDate(this.daysTo);else{let e=new Date(this.from),s=new Date(this.to),i=Math.abs(s-e),a=new Date(this.from),o=new Date(this.to);"prev"==t&&(i=-i),this.from=new Date(a.setMilliseconds(a.getMilliseconds()+i)).toISOString().split("T")[0],this.to=new Date(o.setMilliseconds(o.getMilliseconds()+i)).toISOString().split("T")[0]}this.loadChartData()},afterZoom(t,{xaxis:e}){this.from=new Date(e.min).toISOString().split("T")[0],this.to=new Date(e.max).toISOString().split("T")[0],this.loadChartData()},getTimeSteps(){let t=new Date(this.from),e=new Date(this.to+" 23:59:59"),s=Math.abs(e-t);return s/this.app.options.maxChartPoints},loadChartData(){this.fromPicker=!1,this.toPicker=!1,this.timeSteps=this.getTimeSteps(),this.$fhem.loading=!0;let t={deviceName:this.item.Name,from:this.from,to:this.to,defs:this.item.Options.chartDef},e=[];this.readLogData(t).then((t=>{if(t.length>0)for(const s of t){let t={data:this.handleLogData(s.data,s.calcMode),name:s.name};if(s.type&&(t.type=s.type),s.format){let t=s.format.split(" "),e={labels:{formatter:e=>{let i="",a=/%n./.test(t[0])?s.format.substring(t[0].match(/%n./).index+3,t[0].match(/%n./).index+4):1,o=t[1]?t[1]:"";return e&&(i=e.toLocaleString(this.app.options.lang,{minimumFractionDigits:a,maximumFractionDigits:a})+o),i}}};this.chart.options.yaxis&&this.chart.options.yaxis[s.id]?this.chart.options.yaxis[s.id].labels=e.labels:("undefined"===typeof this.chart.options.yaxis&&(this.chart.options.yaxis=[]),this.chart.options.yaxis.push(e))}e.push(t)}})).finally((()=>{this.chart.options=Object.assign({},this.chart.options),this.chart.series=e,this.$fhem.loading=!1}))},setTimeStep(t,e,s){switch(e||t.setTime(t.getTime()-1e3),s){case"hour":t.setTime(t.getTime()+36e5);break;case"day":t.setDate(t.getDate()+1);break;case"week":t.setDate(t.getDate()+7);break;case"month":t.setMonth(t.getMonth()+1);break;default:while(t<e)t.setMilliseconds(t.getMilliseconds()+this.timeSteps)}return t},handleLogData(t,e){let s=[],i=null,a=null,o=null,n=1,r=e?e.split("-")[0]:null,l=e?e.split("-")[1]:null,c=this.setTimeStep(new Date(this.from+"T00:00:00"),null,l),h=t.split("\n");h.length>3&&h.splice(-3,3),"raw"==r&&h.length>window.innerWidth&&(r=null);for(const[p,m]of h.entries()){let t=m.split(" "),e=new Date(t[0].replace("_","T")),d=parseFloat(t[1]);if("raw"==r)d==a&&h.length!=p+1||s.push([Date.parse(e),d]),a=d;else if(e<c&&p+1<h.length)switch(r){case"min":(d<i||!i)&&(i=d);break;case"max":(d>i||!i)&&(i=d);break;case"delta":o||(o=d);break;default:i&&n++,i+=d}else"delta"==r&&o&&(i=d-o),i||"delta"==r||(i=d),r||(i/=n),i&&s.push([Date.parse(c),i]),c=this.setTimeStep(c,e,l),a=i,i=null,o=null,n=1}return s},async readLogData(t){let e=[];if(t.defs&&t.defs.length>0)for(const[s,i]of t.defs.entries()){let a=/\(.*\)/.exec(i),o=a?i.replace(a[0],"_").split(":"):i.split(":"),n="get ";n+=o[0]?o[0]:t.deviceName,n+=t.from?" - - "+t.from:"",n+=t.to?" "+t.to:"",n+=a?" "+a[0].replace(/\(|\)/g,""):" 4:"+o[1];let r=await this.$fhem.request([{param:"cmd",value:n},{param:"XHR",value:"1"}],"text",{id:s});r&&e.push({id:r.id,data:await r.data,name:o[2]||o[1],format:o[3],type:o[4],calcMode:o[5]})}return e}}},k=_,y=s(1001),O=(0,y.Z)(k,g,x,!1,null,null,null),w=O.exports}}]);